{% extends "blog/base.html" %}
{% block content %}
<article class="card">
  <div class="card-body">
    <h1 class="card-title h3">{{ post.title }}</h1>
    <p class="text-muted mb-3">by {{ post.author }} · {{ post.created_at|date:"M d, Y H:i" }}</p>
    <div class="card-text" style="white-space: pre-wrap;">{{ post.content }}</div>

    {% if user.is_authenticated and user == post.author %}
      <div class="mt-3 d-flex gap-2">
        <a class="btn btn-outline-secondary" href="{% url 'blog:post_update' post.pk %}">Edit</a>
        <a class="btn btn-outline-danger" href="{% url 'blog:post_delete' post.pk %}">Delete</a>
      </div>
    {% endif %}
  </div>
</article>

{% block content %}
<article class="card mb-4">
  <div class="card-body">
    <h1 class="h3">{{ post.title }}</h1>
    <p class="text-muted">by {{ post.author }} · {{ post.created_at|date:"M d, Y H:i" }}</p>
    <div style="white-space: pre-wrap;">{{ post.content }}</div>
  </div>
</article>
 
<!-- Comments Section -->
<h2 class="h5 mt-4">Comments</h2>
{% for comment in post.comments.all %}
  <div class="mb-3 p-2 border rounded bg-white">
    <p class="mb-1"><strong>{{ comment.author }}</strong> said:</p>
    <p class="mb-0">{{ comment.content }}</p>
    <small class="text-muted">{{ comment.created_at|date:"M d, Y H:i" }}</small>
    {% if user.is_authenticated and user == comment.author %}
      <div class="mt-2">
        <a class="btn btn-outline-secondary btn-sm" href="{% url 'blog:comment_update' comment.pk %}">Edit</a>
        <a class="btn btn-outline-danger btn-sm" href="{% url 'blog:comment_delete' comment.pk %}">Delete</a>
      </div>
    {% endif %}
  </div>
{% empty %}
  <p>No comments yet.</p>
{% endfor %}

{% if user.is_authenticated %}
  <form method="post" action="{% url 'blog:comment_create' post.pk %}" class="mt-3">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button type="submit" class="btn btn-primary btn-sm">Add Comment</button>
  </form>
{% else %}
  <p><a href="{% url 'login' %}?next={{ request.path }}">Login</a> to leave a comment.</p>
{% endif %}

<a class="btn btn-link mt-3" href="{% url 'blog:post_list' %}">← Back to posts</a>
<p>Tags:
  {% for tag in post.tags.all %}
    <a href="{% url 'tag_posts' tag.name %}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
  {% empty %}
    No tags
  {% endfor %}
</p>

{% endblock %}


